<!DOCTYPE html>
<html>
  <head>
    <title>YouTube Video with Current Time Display</title>
  </head>
  <body>
    <h1>Enter a YouTube Link</h1>
    <form>
      <label for="link">YouTube Link:</label>
      <input type="text" id="link" name="link">
      <button type="submit">Embed</button>
    </form>
    <div id="player"></div>
    <p id="current-time"></p>
    <p id="ending-time"></p>
    <script>
      // Initialize the player object

      let player;
     
      // Function to update the current time display
	  
	//  function clearBox(elementID)
	//{
	//	document.getElementById(elementID).innerHTML = "";
	//}
	
      function updateCurrentTime() {
        const seconds = player.getCurrentTime();
		//var date = new Date(null);
		//date.setSeconds(seconds);
		//var hhmmssFormat = date.toISOString().substr(11,8);
		//var mmssFormat = date.toISOString().substring(14,19);


		
		//same for ending time 
		const endSeconds = Number(document.querySelector("#end-time").value);
		var dateEnd = new Date(null);
		dateEnd.setSeconds(endSeconds + seconds);
		//var hhmmssFormatEnd = dateEnd.toISOString().substr(11,8);
		//var mmssFormatEnd = dateEnd.toISOString().substring(14,19); 
		//var hhmmssFormatEnd = new Date(endSeconds * 1000).toISOString().substring(11, 16)
		//var mmssFormatEnd = new Date(endSeconds * 1000).toISOString().substring(14, 19);


		
		
		if (seconds > 3600){
			var hhmmssFormat = new Date(seconds * 1000).toISOString().substring(11, 19);
			document.querySelector("#current-time").innerHTML = "Current Time: " + hhmmssFormat;
		} else {
			var mmssFormat = new Date(seconds * 1000).toISOString().substring(14, 19);
			document.querySelector("#current-time").innerHTML = "Current Time: " + mmssFormat;
		}
		
		if (seconds + endSeconds > 3600){
			var hhmmssFormatEnd = dateEnd.toISOString().substr(11,8);
			document.querySelector("#ending-time").innerHTML = "End Time: " + hhmmssFormatEnd;
		} else {
			var mmssFormatEnd = dateEnd.toISOString().substring(14,19); 
			document.querySelector("#ending-time").innerHTML = "End Time: " + mmssFormatEnd;
		}
		
		//move this later!! To listen to range event
		document.querySelector("#slider-time").innerHTML = "Clip length: " + endSeconds + " seconds.";


      }
      
      // Listen for form submission event
      document.querySelector("form").addEventListener("submit", (event) => {
        event.preventDefault();
        
	//	clearBox("player");
		
        // Get the YouTube link
        const link = document.querySelector("#link").value;
        
        // Extract the video ID from the link
        const videoId = link.split("v=")[1];
        
		
        // Create the player object if it does not exist, otherwise update existing

		if (typeof player != 'object'){
		player = new YT.Player("player", {
          height: "360",
          width: "640",
          videoId: videoId,
          events: {
            "onReady": () => {
              // Set an interval to update the current time display every second
              setInterval(updateCurrentTime, 150);
            }
          }
        });
		} else {
			//let link2 = document.getElementById("player");
			//link2.src = "https://www.youtube.com/embed/" + videoId;
			//link2.events = {
            //"onReady": () => {
            //  setInterval(updateCurrentTime, 150);
			player.loadVideoById({videoId: videoId, startSeconds:0});
            }
          });
		
		;
    </script>
	<input type="range" id="end-time" name="end-time" min="0" max="100" value="100">
<button id="play-button">Play Selected Time Span</button>
<p id="slider-time"></p>


<script>
      const form = document.querySelector('form');
      const videoDiv = document.querySelector('#video');
      const currentTimeValue = updateCurrentTime();
      const endTimeSlider = document.querySelector('#end-time');
      const playButton = document.querySelector('#play-button');
      let embedLink = '';
      let videoId = '';
      form.addEventListener('submit', (event) => {
        event.preventDefault();
        const link = document.querySelector('#link').value;
        videoId = link.split('v=')[1];
        embedLink = `https://www.youtube.com/embed/${videoId}`;
        videoDiv.innerHTML = `<iframe id="video-iframe" width="560" height="315" src="${embedLink}" frameborder="0" allowfullscreen></iframe>`;
      });
      
	  playButton.addEventListener('click', () => {
        const startTime = updateCurrentTime();
        const endTime = updateCurrentTime() + endTimeSlider.value;
        const videoIframe = document.querySelector('#video-iframe');
        videoIframe.src = `${embedLink}?start=${startTime}&end=${endTime}`;
      });
    </script>
    
    <!-- Load the YouTube IFrame API -->
    <script src="https://www.youtube.com/iframe_api"></script>
  </body>