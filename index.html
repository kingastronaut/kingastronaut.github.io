<!DOCTYPE html>
<html>
  <head>
    <title>YouTube Video with Current Time Display</title>
  </head>
  <body>
    <h1>Enter a YouTube Link</h1>
    <form>
      <label for="link">YouTube Link:</label>
      <input type="text" id="link" name="link">
      <button type="submit">Embed</button>
    </form>
    <div id="player"></div>
    <p id="current-time"></p>
    <p id="ending-time"></p>
	<input type="range" id="end-time" name="end-time" min="0" max="15" value="15">
	<button id="play-button">Play Selected Time Span</button>
	<p id="slider-time"></p>
    <script>
      // Initialize the player object

      let player;
	  let timestamps;
     
      // Function to update the current time display
	  
      function updateCurrentTime() {
        const seconds = player.getCurrentTime();
		
		const endSeconds = Number(document.querySelector("#end-time").value);
		var dateEnd = new Date(null);
		dateEnd.setSeconds(endSeconds + seconds);


		if (seconds > 3600){
			var hhmmssFormat = new Date(seconds * 1000).toISOString().substring(11, 19);
			document.querySelector("#current-time").innerHTML = "Current Time: " + hhmmssFormat;
		} else {
			var mmssFormat = new Date(seconds * 1000).toISOString().substring(14, 19);
			document.querySelector("#current-time").innerHTML = "Current Time: " + mmssFormat;
		}
		
		if (seconds + endSeconds > 3600){
			var hhmmssFormatEnd = dateEnd.toISOString().substr(11,8);
			document.querySelector("#ending-time").innerHTML = "End Time: " + hhmmssFormatEnd;
		} else {
			var mmssFormatEnd = dateEnd.toISOString().substring(14,19); 
			document.querySelector("#ending-time").innerHTML = "End Time: " + mmssFormatEnd;
		}
		
		//move this later!! To listen to range event
		document.querySelector("#slider-time").innerHTML = "Clip length: " + endSeconds + " seconds.";


      }
      
      // Listen for form submission event
      document.querySelector("form").addEventListener("submit", (event) => {
        event.preventDefault();
        
	//	clearBox("player");
		
        // Get the YouTube link
        const link = document.querySelector("#link").value;
        
        // Extract the video ID from the link
        const videoId = link.split("v=")[1];
        
		
        // Create the player object if it does not exist, otherwise update existing

		if (typeof player != 'object'){
		player = new YT.Player("player", {
          height: "360",
          width: "640",
          videoId: videoId,
          events: {
            "onReady": () => {
              // Set an interval to update the current time display every second
              setInterval(updateCurrentTime, 150);
            }
          }
        });
		} else {
			player.loadVideoById({videoId: videoId, startSeconds:0});
			//player.playVideo();
            }
          });
		  
		  
		  
		 // HERE FOR STARTSTOP BUTTON
		
		document.querySelector("#play-button").addEventListener("click", (event) => {
			event.preventDefault();
			
			 // Get the YouTube link
			const link2 = document.querySelector("#link").value;
        
			// Extract the video ID from the link
			const videoId2 = link2.split("v=")[1];
			
			//create link with timestamps and play the range
			const videoStartSeconds = player.getCurrentTime();
			const videoEndSeconds = Number(document.querySelector("#end-time").value) + videoStartSeconds;
			const videoIdRange = videoId2 + "?start=" + Math.floor(videoStartSeconds) + "&end=" + Math.floor(videoEndSeconds);
			
			if (typeof timestamps != 'object'){
				timestamps = {
				start: Math.floor(videoStartSeconds),
				end: Math.floor(videoEndSeconds)}
				//var startT = Math.floor(videoStartSeconds);
				//var endT = Math.floor(videoEndSeconds);
			};
			
			
			player.loadVideoById({videoId: videoId2, startSeconds:timestamps["start"], endSeconds: timestamps["end"]});

		});
    </script>

    <script src="https://www.youtube.com/iframe_api"></script>
  </body>